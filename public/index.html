<!DOCTYPE html>
<html>
<head>
<link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet" type="text/css">
<style>
  body {
    font-family: 'Open+Sans', sans;
    font-size: 14px;
  }
</style>
<title>Age At Home</title>
</head>
<!-- start Intercom -->
<script> window.intercomSettings = { app_id: "qhj4pwpj" }; </script>
<script>(function(){var w=window;var ic=w.Intercom;if(typeof ic==="function"){ic('reattach_activator');ic('update',intercomSettings);}else{var d=document;var i=function(){i.c(arguments)};i.q=[];i.c=function(args){i.q.push(args)};w.Intercom=i;function l(){var s=d.createElement('script');s.type='text/javascript';s.async=true;s.src='https://widget.intercom.io/widget/qhj4pwpj';var x=d.getElementsByTagName('script')[0];x.parentNode.insertBefore(s,x);}if(w.attachEvent){w.attachEvent('onload',l);}else{w.addEventListener('load',l,false);}}})()</script>
<!-- end Intercom -->
<!-- start Mixpanel -->
<script type="text/javascript">(function(e,b){if(!b.__SV){var a,f,i,g;window.mixpanel=b;b._i=[];b.init=function(a,e,d){function f(b,h){var a=h.split(".");2==a.length&&(b=b[a[0]],h=a[1]);b[h]=function(){b.push([h].concat(Array.prototype.slice.call(arguments,0)))}}var c=b;"undefined"!==typeof d?c=b[d]=[]:d="mixpanel";c.people=c.people||[];c.toString=function(b){var a="mixpanel";"mixpanel"!==d&&(a+="."+d);b||(a+=" (stub)");return a};c.people.toString=function(){return c.toString(1)+".people (stub)"};i="disable time_event track track_pageview track_links track_forms register register_once alias unregister identify name_tag set_config people.set people.set_once people.increment people.append people.union people.track_charge people.clear_charges people.delete_user".split(" ");
for(g=0;g<i.length;g++)f(c,i[g]);b._i.push([a,e,d])};b.__SV=1.2;a=e.createElement("script");a.type="text/javascript";a.async=!0;a.src="undefined"!==typeof MIXPANEL_CUSTOM_LIB_URL?MIXPANEL_CUSTOM_LIB_URL:"file:"===e.location.protocol&&"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js".match(/^\/\//)?"https://cdn.mxpnl.com/libs/mixpanel-2-latest.min.js":"//cdn.mxpnl.com/libs/mixpanel-2-latest.min.js";f=e.getElementsByTagName("script")[0];f.parentNode.insertBefore(a,f)}})(document,window.mixpanel||[]);
mixpanel.init("8ce3a282a575094e41bbc4b4b0f4bf9e");
mixpanel.track("home");
</script>
<!-- end Mixpanel -->
<body>
<a href="https://cognitivebuild.bluefundit.com/project/56ee0073f6ec6de43b0d6344">
<img width="10%" src="images/age-at-home.jpg">
</a>
<h1>
Age-At-Home
</h1>
<h2>What is it?</h2>
<p>
Improve the elderlys' ability to age at home through understanding of daily activities inferred from passive sensor analysis.
<h2>
How it Works
</h2>
<p>
The need for helping elderly individuals or couples remain in their home is increasing as our global population ages.  Cognitive processing offers opportunities to assist the elderly by processing information to identify opportunities for caregivers to offer assistance and support.
<p>
Rather than depending on sensors worn on the body (and needing to be not forgotten, recharged, etc..) or installing sensors on individual devices (e.g. sink, cabinet, refrigerator, etc..), this solution utilizes passive monitoring devices, notably video camera(s) with multi-channel microphones, to sense activity, record events, and build a model of normative behavior.
<p>
<img width="75%" src="images/basic-scenario.png">
<table>
<tr valigh="top"><td width="70%">
Initially we intend to monitor the kitchen and recognizes the presence of a person (not an individual) in the room. From this simple event detection we will build a normative baseline of daily activity and detect when that daily activity exhibits aberrations (e.g. no activity in kitchen after +2 std. dev. past median time).
The visual recognition algorithm will run on the local device (e.g. RaspberryPi with camera), the issues of round-trip latency to the cloud, or bandwidth required, or security or privacy concerns, will be eliminated.  Only events generated from this recognition will be sent to the cloud to build (and update) the normative behavior model.
This initial scenario may be easily extended to other passive monitoring capabilities, e.g. audio, motion (sonar), electrical circuit, , ... as well as deployment in other area, e.g. entry way, bathroom, hallway, etc.. to provide support for additional scenarios, e.g. medication adherence, diet, exercise, ... 
</td>
<td>
<img width="75%" src="images/bellcurve.png">
</td>
</tr>
</table>
<p>

<table border="1">
<tr><th>Location</th><th>Date-Time</th></tr>
<tr valign="top"><td>Kitchen</td><td height="10"><img src="https://ibmcds.looker.com/looks/P7QkTrRjNVpGfj4Vgz8m8Qzb7cFw8Z4X.png"></td></tr>
<tr valign="top"><td>Bathroom</td><td height="10"><img src="https://ibmcds.looker.com/looks/QYMvmW69kbcPxf3MkN43jSrgJ2NvBg9D.png"</td></tr>
</table>

<div id="id01" />
<script>
function handler() {
 if(this.status == 200 &&
   this.responseXML != null &&
   this.responseXML.getElementById('dampcloud.alchemy_time').textContent) {
   // success!
   id01.innerHTML = this.responseXML.getElementById('dampcloud.alchemy_time').textContent;
 } else {
   // something went wrong
 }
}

var url = "http://www.dcmartin.com/CGI/aah-last.cgi";
var client = new XMLHttpRequest();
client.onload = handler;
client.open("GET", url, true);
client.send();
</script>

<p>
<h2>System Overview</h2>
<p>
The solution is patterned on a "do-it-yourself" (DIY) approach and utilizes inexpensive hardware, open source software, and free services from the IBM BlueMix cloud.  The local device is comprised of a RaspberryPi computer and PlayStation3 Eye USB camera with four (4) internal microphones.  Total cost of hardware is under US$80 on-line.
<br>
<img width="75%" src="images/system-overview.png">
<p>
The <a href="http://www.bluemix.net/">IBM BlueMix</a> cloud provides a suite of services for the application, including this Web site, which is a Node.js CloudFoundry application.
The BlueMix environment enables this application context to apply to other services, 
notably the IBM Watson <a href="http://www.ibm.com/smarterplanet/us/en/ibmwatson/developercloud/visual-recognition.html">image recognition services</a>.  
In addition, the <a href="http://cloudant.com/">Cloudant</a> NoSQL repository stores the historical event and image recognition information.
<p>
BlueMix also provides the <a href="http://www.ibm.com/software/data/dashdb/">dashDB</a> hybrid relational data warehousing service.  
This service automatically replicates from the Cloudant repository and provides an SQL interface for SELECT, PROJECT and JOIN.
This SQL services can also be consumed by <a href="http://watson.analytics.ibmcloud.com">Watson Analytics</a> and other third-party software packages from IBM 
and business partners (e.g. <a href="http://www.looker.com">Looker</a>).
<p>
Also on BlueMix, the IBM <a href="https://internetofthings.ibmcloud.com/">Internet of Things</a> platform and 
associated <a href="https://iotrti-prod.mam.ibmserviceengage.com/">Real-Time Insights</a> provide device registration and system status monitoring for the RaspberryPi.
General purpose conditionals can be applied for integration with email, <a href="http://www.ifttt.com">IFTTT</a>, Node.Red and arbitrary web-hook.
<p>
In addition, this site utilizes Mixpanel (www.mixpanel.com) and Intercom.io (www.intercom.io) to provide user tracking and near-line chat
(n.b. look in lower right corner for chat icon).
<h2>
Analysis
</h2>
<p>
With several weeks of data collected patterns are emerging.  Initial analysis step was to understand the classsifiers tagged in the images.
<h3>
Step 1: Watson Analytics
</h3>
<p>
Data was processed from JSON in Cloudant into CSV files for each device.  Resulting data included listing of all classifiers by fifteen (15) minute interval per day.
<ul>
<li> <a href="data/rough-fog-all-intervals.csv">All classifiers by interval for rough-fog</a>
<li> <a href="data/damp-cloud-all-intervals.csv">All classifiers by interval for damp-cloud</a>
</ul>
<p>
These images are created using <a href="https://watson.analytics.ibmcloud.com/">Watson Analytics</a>.  It is simple to get a free account and load the CSV files.
Import these CSV files into Watson Analytics, refine the data model and explore yields the following graphical displays of the classifier space.
<p>
<table width="100%">
<tr valign="top">
<td width="30%" align="center">
<figure>
    <a href="images/classifier-heatmap.png"><img width="95%" src="images/classifier-heatmap.png"></a>
    <figcaption>Heatmap of classifiers</figcaption>
</figure>
</td>
<td width="30%" align="center">
<figure>
    <a href="images/score-hour-classifier.png"><img width="95%" src="images/score-hour-classifier.png"></a>
    <figcaption>Primary Classifiers</figcaption>
</figure>
</td>
<td width="30%" align="center">
<figure>
    <a href="images/hour-classifier-relationship.png"><img width="95%" src="images/hour-classifier-relationship.png"></a>
    <figcaption>Relationship between hour, day and classifier</figcaption>
</figure>
</td>
</tr>
</table>
<p>
The heatmap of classifiers as well as the primary classifiers across hour of day were both highly informative.  This insight lead the selection of the following classifiers 
from the VisualInsights recognition algorithms for further investigation using Looker.
<h3>
Step 2: Looker
</h3>
<p>
Analysis of the underlying events which generated the classifications lead to analysis using Looker.  Looker generates SQL for the dashDB replicant of the Cloudant JSON event history 
and then makes that output available for visualization and download as JSON.  The following two graphics are "live" views of the rough-fog and damp-cloud events.
<p>
<iframe src='https://ibmcds.looker.com/embed/public/vQFVvQSgTFKHpgfmrPXKc8bsspQ2pF2Z' width='1000' height='350' frameborder='0'></iframe>
<p>
<iframe src='https://ibmcds.looker.com/embed/public/M9B2vPX7RD9Sf4PwDyNWQ6dR46pCS5qd' width='1000' height='350' frameborder='0'></iframe>
<p>
<iframe src='https://ibmcds.looker.com/embed/public/ZMdS9gbqv7mvmGqnvZHTbmGY4n53TBXV' width='1000' height='350' frameborder='0'></iframe>
<p>
<iframe src='https://ibmcds.looker.com/embed/public/J8Y8FBCQCTXHtC3KGN2bW96bksMczNbX' width='1000' height='350' frameborder='0'></iframe>
<p>
<iframe src='https://ibmcds.looker.com/embed/public/vmFgFKSvCpN6qY2JjyZWnCjzrh3qSHK7' width='1000' height='350' frameborder='0'></iframe>
<p>
<iframe src='https://ibmcds.looker.com/embed/public/gXpvq8ykFPkMv2xFF3Tzg3mrG3jVt4HJ' width='1000' height='350' frameborder='0'></iframe>
<p>
<iframe src='https://ibmcds.looker.com/embed/public/bhRrfdbXN6vwd5SpFWvGgbRXDW6mxhTD' width='1000' height='350' frameborder='0'></iframe>
<p>
<iframe src='https://ibmcds.looker.com/embed/public/MVDPdzgN9mckKZvnScxGHhGTTcKczjC3' width='1000' height='350' frameborder='0'></iframe>
<h3>
Step 3: Excel
</h3>
<p>
The same UNIX script 
(<code><a href="bin/mkclass">mkclass</a></code>)
that converts the Cloudant JSON into CSV files suitable to Watson Analytics is also suitable 
for consumption by Excel.
The script builds the classifier (or classifier set, e.g. 'people') population statistics model for the specified device.
The results are processed in the <a href="data/rough-fog-person.xslx">Excel spreadsheet</a> to produce the charts below.
<ol>
<li>All Activity; the sum of 'person' events in the kitchen
<li>Expected Activity; when 'person' count by 'intervals' "near" mean of interval count
<li>Over Activity; when 'person' count by 'interval' is +2SD over mean of interval count
<li>Under Activity; when 'person' count by 'interval' is -2SD under mean of interval count
</ol>
<table>
<tr>
<td><a href="images/person-active.png"><img width="95%" src="images/person-active.png"></a></td>
<td><a href="images/person-normal-active.png"><img width="95%" src="images/person-normal-active.png"></a></td>
</tr>
<tr>
<td><a href="images/person-over-active.png"><img width="95%" src="images/person-over-active.png"></a></td>
<td><a href="images/person-under-active.png"><img width="95%" src="images/person-under-active.png"></a></td>
</tr>
</table>
<h2>
Step 4: Web Services
</h2>
With analytical understanding of the event classifier space and corresponding activity for specific classifiers by day of week and interval of day,
a model can now be constructed to determine the average time of first activity in the AM.  That model is calculated on the server, based on the historical 
event data and supplied to the device on demand through a Web service.
The Web service is a HTTP address with parameters that invokes logic to to return a result, e.g. the average score for Person in a given interval of time.
<p>
Below are some examples of the <code>aah-stats</code> Web service:
<ul>
<li>
Calculates / updates statistical model for device and classifier
<a href="http://www.dcmartin.com/CGI/aah-stats.cgi?db=rough-fog&id=person"><code>aah-stats?db=rough-fog&id=person</code></a>
<li>
Calculates / updates statistical model for days of week or device and classifier
<a href="http://www.dcmartin.com/CGI/aah-stats.cgi?db=rough-fog&id=person&day=all"><code>aah-stats?db=rough-fog&id=person&day=all</code></a>
<li>
Calculates / updates statistical model for intervals of day for device and classifier
<a href="http://www.dcmartin.com/CGI/aah-stats.cgi?db=rough-fog&id=person&interval=all"><code>aah-stats?db=rough-fog&id=person&interval=all</code></a>
<li>
Calculate / update list of all classifiers for device (e.g. "db=rough-fog")
<a href="http://www.dcmartin.com/CGI/aah-classifiers.cgi?db=rough-fog"><code>aah-classifiers</code></a> 
</ul>
The id= argument can be specified with any of the classifiers.  The day= and interval= arguments can be specified with &quot;all&quot; or a number for day (0-6) or interval (0-95).
<p>
<img width="75%" src="images/command-line.png">
<p>
This information is consumed by the RaspberryPi and utilized to compare current events with the historical population statistics.
Local conditional testing is currently in-progress, utilizing the <code>motion</code> package capability for additional event processing.
<h2>Examples</h2>
Image captured using motion detection algorithm based on changes in pixel count (bounding box around centroid identifed).
<p>
<img width="50%" alt="High confidence example" src="images/hiconf.png">
<br>
<img width="50%" alt="Low confidence example" src="images/loconf.png">
<h2>Equipment</h2>
The necessary equipment for this project is relatively inexpensive:
A RaspberryPi3 with 32 GB uSD card and Playstation3 Eye USB camera
<p>
<img width="50%" src="images/camera.png">
<br>
<i>Installation on kitchen shelf</i>
<p>
<ul>
<li>RaspberryPi3 ~ US$45.00
<li>Enclosure, uSD card, power-supply ~ US$30
<li>Playstation3 Eye camera ~ US$5 (WOW!)
</ul>
<b>TOTAL COST: ~ US$80!</b>  For comparison, a DropCam from Nest (aka Google) is ~ US$199.
<p>
<img width="25%" src="images/Rp3.png">
<br>
<img width="25%" src="images/Rpi3 case.png">
<img width="25%" src="images/uSD-32bg.png">
<br>
<img width="25%" src="images/Rpi3 power.png">
<img width="25%" src="images/ps3eyecamera.png">
<p>
<h2>Infrastructure</h2>
We are making use of <a href="http://resin.io/">resin.io</a> to manage the build and deployment process to the Raspberry Pi devices.
<p>
The resin.io service provides a customizable base image with which to "flash" the uSD card for the RaspberryPi.  The image may be configured 
with the SSID and password for the local WiFi network.
<p>
The "AgeAtHome" application we have defined provides a context in which devices participate.  Each device is assigned to one application.
Once a device has been flashed and booted, it connects to the resin.io service and presents itself within the application context.
<p>
<img width="24%" src="images/resin-app.png">
<p>
Each device associated with the application can be inspected, including summary status and logs (e.g. stderr).
<p>
<img width="75%" src="images/resin-detail.png">
<p>
Including the ability to ssh(1) into a terminal for command line interface:
<br>
<img width="75%" src="images/terminal.png">
<br>
<i>Listing of motion detection volume data in file system</i>


<h2>IBM IoTF Platform</h2>
I added the IBM IoT Foundation <a href="https://developer.ibm.com/recipes/tutorials/raspberry-pi-4/">Quickstart for Raspberry Pi</a>
to the environment and you can see a <a href="https://quickstart.internetofthings.ibmcloud.com/#/device/b827eb7bf9fb"> live stream </a>
of instrumentation data.  The dashboard below is shown once a device is registered to a BlueMix account and affiliated with an organization (another level of indirection 
off your BlueMix account).
<p>
<img width="33%" src="images/iotf-platform-dashboard.png">
<br> <i>IBM IoTF Platform Dashboard</i>
<p>
Changes were made to both Dockerfile as well as initial script to enable IoTF/QS and sample C program only sends system status.  Will need to change
the sample program to progres HTTP requests to send any JSON payloads (i.e. our events).
<h3>
IBM IOTF Real-time Insights
</h3>
The IBM IOTF Real-time Insights capabilities can be linked to the IOTF Platform 
through a shared repository for the JSON events received by the platform; the JSON objects in that repository provide schemas for payload processing.
The IOTF-RTI environment provides for rules to be specified in conjunction with JSON
payload values using numeric comparison to static values, other payload values, and context parameters (n.b. unsure where or how these values are set).
<p>
<img width="33%" src="images/iotf-realtime-insights.png">
<br><i>IBM IOTF Real-time Insights <i>rule</i> specification</i>
<p>
<img width="33%" src="images/iotf-realtime-insights-condition.png">
<br><i>IBM IOTF Real-time Insights <i>rule</i> <b>condition</b> specification</i>
<p>
<img width="33%" src="images/iotf-realtime-insights-action.png">
<br><i>IBM IOTF Real-time Insights <i>rule</i> <b>action</b> specification</i>
<h2>
System Detail
</h2>
<p>
The following image is a more detailed diagram of the system operational components and process.
<p>
<a href="images/system-detail.png"><img src="images/system-detail.png" width="75%"></a>
<p>
GitHub repositories are publically accessible at:
<ul>
<li><a href="https://github.com/dcmartin/AgeAtHome">RaspberryPi container for resin.io deployment</a>
<li><a href="https://github.com/dcmartin/age-at-home">BlueMix CloudFoundry application</a>.
</ul>
SETUP (in-progress):
<ol>
<li><a href="http://www.dcmartin.com/CGI/appstore.cgi">Download</a> RaspberryPi image (Ethernet only; working on WiFi)
<li>Use <a href="http://www.etcher.io/">Etcher</a> to copy image to SD card
<li>Insert SD card in RaspberryPi & connect camera and power
<li>Configure RaspberryPi using Web browser (port <a href="http://192.168.1.97:8080/">8080</a> ; image at port <a href="192.168.1.97:8081">8081</a>)
<li>Send me an <a href="mailto:dcmartin@us.ibm.com">email</a> to setup server side; working on automation
<li>View <i>your</i> Looker graphs on-line (in progress)
<li>Setup conditionals for notification (in progress)
</ol>
<h2>More Information</h2>
<img width="5%" src="images/dcm.jpg">
<p>
If you've read all the way to here and you still want more information, you can find me at the following places; or click on the little blue circle in the lower right of your web browser to talk to me directly:
<a href="http://www.linkedin.com/in/davidcharlesmartin/">LinkedIn</a>
<a href="http://www.github.com/dcmartin">GitHub</a>
<a href="http://www.twitter.com/dcmartin/">Twitter</a>
</body>
</html>
